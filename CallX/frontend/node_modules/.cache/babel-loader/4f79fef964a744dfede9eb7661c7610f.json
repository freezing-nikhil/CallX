{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Nikita\\\\OneDrive\\\\Desktop\\\\Nik\\\\CallX\\\\frontend\\\\src\\\\pages\\\\Steps\\\\StepAvatar\\\\StepAvatar.jsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from 'react';\nimport Card from '../../../components/shared/Card/Card';\nimport Button from '../../../components/shared/Button/Button';\nimport styles from './StepAvatar.module.css';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { setAvatar } from '../../../store/activateSlice';\nimport { activate } from '../../../http';\nimport { setAuth } from '../../../store/authSlice';\nimport Loader from '../../../components/shared/Loader/Loader';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst StepAvatar = ({\n  onNext\n}) => {\n  _s();\n  const dispatch = useDispatch();\n  const {\n    name,\n    avatar\n  } = useSelector(state => state.activate);\n  const [image, setImage] = useState('/images/monkey-avatar.png');\n  const [loading, setLoading] = useState(false);\n  const [unMounted, setUnMounted] = useState(false);\n  function captureImage(e) {\n    const file = e.target.files[0];\n    if (!file) return;\n\n    // Validate type\n    if (!file.type.startsWith('image/')) {\n      alert('Please upload a valid image file.');\n      return;\n    }\n\n    // Validate size (max 2MB)\n    if (file.size > 2 * 1024 * 1024) {\n      alert('File too large! Max size is 2MB.');\n      return;\n    }\n    const reader = new FileReader();\n    reader.readAsDataURL(file);\n    reader.onloadend = () => {\n      setImage(reader.result); // preview\n      dispatch(setAvatar(reader.result)); // save to redux\n    };\n  }\n  async function submit() {\n    if (!name || !avatar) return alert('Name and avatar are required!');\n    setLoading(true);\n    try {\n      // send base64 directly\n      const {\n        data\n      } = await activate({\n        name,\n        avatar\n      });\n      if (data.auth) {\n        if (!unMounted) {\n          dispatch(setAuth(data));\n          if (onNext) onNext(); // move to next step\n        }\n      }\n    } catch (err) {\n      var _err$response, _err$response2, _err$response2$data;\n      console.error('Activation error:', ((_err$response = err.response) === null || _err$response === void 0 ? void 0 : _err$response.data) || err.message);\n      alert(((_err$response2 = err.response) === null || _err$response2 === void 0 ? void 0 : (_err$response2$data = _err$response2.data) === null || _err$response2$data === void 0 ? void 0 : _err$response2$data.message) || 'Activation failed!');\n    } finally {\n      setLoading(false);\n    }\n  }\n  useEffect(() => {\n    return () => setUnMounted(true);\n  }, []);\n  if (loading) return /*#__PURE__*/_jsxDEV(Loader, {\n    message: \"Activation in progress...\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 67,\n    columnNumber: 25\n  }, this);\n  return /*#__PURE__*/_jsxDEV(Card, {\n    title: `Okay, ${name}`,\n    icon: \"monkey-emoji\",\n    children: [/*#__PURE__*/_jsxDEV(\"p\", {\n      className: styles.subHeading,\n      children: \"How\\u2019s this photo?\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 71,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: styles.avatarWrapper,\n      children: /*#__PURE__*/_jsxDEV(\"img\", {\n        className: styles.avatarImage,\n        src: image,\n        alt: \"avatar\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 73,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 72,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n        onChange: captureImage,\n        id: \"avatarInput\",\n        type: \"file\",\n        className: styles.avatarInput\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 76,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n        className: styles.avatarLabel,\n        htmlFor: \"avatarInput\",\n        children: \"Choose a different photo\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 82,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 75,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      children: /*#__PURE__*/_jsxDEV(Button, {\n        onClick: submit,\n        text: \"Next\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 87,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 86,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 70,\n    columnNumber: 9\n  }, this);\n};\n_s(StepAvatar, \"edLf9Rvx6AxrhoXMpdnYP8ilct4=\", false, function () {\n  return [useDispatch, useSelector];\n});\n_c = StepAvatar;\nexport default StepAvatar;\nvar _c;\n$RefreshReg$(_c, \"StepAvatar\");","map":{"version":3,"names":["React","useState","useEffect","Card","Button","styles","useSelector","useDispatch","setAvatar","activate","setAuth","Loader","jsxDEV","_jsxDEV","StepAvatar","onNext","_s","dispatch","name","avatar","state","image","setImage","loading","setLoading","unMounted","setUnMounted","captureImage","e","file","target","files","type","startsWith","alert","size","reader","FileReader","readAsDataURL","onloadend","result","submit","data","auth","err","_err$response","_err$response2","_err$response2$data","console","error","response","message","fileName","_jsxFileName","lineNumber","columnNumber","title","icon","children","className","subHeading","avatarWrapper","avatarImage","src","alt","onChange","id","avatarInput","avatarLabel","htmlFor","onClick","text","_c","$RefreshReg$"],"sources":["C:/Users/Nikita/OneDrive/Desktop/Nik/CallX/frontend/src/pages/Steps/StepAvatar/StepAvatar.jsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport Card from '../../../components/shared/Card/Card';\nimport Button from '../../../components/shared/Button/Button';\nimport styles from './StepAvatar.module.css';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { setAvatar } from '../../../store/activateSlice';\nimport { activate } from '../../../http';\nimport { setAuth } from '../../../store/authSlice';\nimport Loader from '../../../components/shared/Loader/Loader';\n\nconst StepAvatar = ({ onNext }) => {\n    const dispatch = useDispatch();\n    const { name, avatar } = useSelector((state) => state.activate);\n    const [image, setImage] = useState('/images/monkey-avatar.png');\n    const [loading, setLoading] = useState(false);\n    const [unMounted, setUnMounted] = useState(false);\n\n    function captureImage(e) {\n        const file = e.target.files[0];\n        if (!file) return;\n\n        // Validate type\n        if (!file.type.startsWith('image/')) {\n            alert('Please upload a valid image file.');\n            return;\n        }\n\n        // Validate size (max 2MB)\n        if (file.size > 2 * 1024 * 1024) {\n            alert('File too large! Max size is 2MB.');\n            return;\n        }\n\n        const reader = new FileReader();\n        reader.readAsDataURL(file);\n        reader.onloadend = () => {\n            setImage(reader.result);         // preview\n            dispatch(setAvatar(reader.result)); // save to redux\n        };\n    }\n\n    async function submit() {\n        if (!name || !avatar) return alert('Name and avatar are required!');\n        setLoading(true);\n\n        try {\n            // send base64 directly\n            const { data } = await activate({ name, avatar });\n            if (data.auth) {\n                if (!unMounted) {\n                    dispatch(setAuth(data));\n                    if (onNext) onNext(); // move to next step\n                }\n            }\n        } catch (err) {\n            console.error('Activation error:', err.response?.data || err.message);\n            alert(err.response?.data?.message || 'Activation failed!');\n        } finally {\n            setLoading(false);\n        }\n    }\n\n    useEffect(() => {\n        return () => setUnMounted(true);\n    }, []);\n\n    if (loading) return <Loader message=\"Activation in progress...\" />;\n\n    return (\n        <Card title={`Okay, ${name}`} icon=\"monkey-emoji\">\n            <p className={styles.subHeading}>Howâ€™s this photo?</p>\n            <div className={styles.avatarWrapper}>\n                <img className={styles.avatarImage} src={image} alt=\"avatar\" />\n            </div>\n            <div>\n                <input\n                    onChange={captureImage}\n                    id=\"avatarInput\"\n                    type=\"file\"\n                    className={styles.avatarInput}\n                />\n                <label className={styles.avatarLabel} htmlFor=\"avatarInput\">\n                    Choose a different photo\n                </label>\n            </div>\n            <div>\n                <Button onClick={submit} text=\"Next\" />\n            </div>\n        </Card>\n    );\n};\n\nexport default StepAvatar;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}